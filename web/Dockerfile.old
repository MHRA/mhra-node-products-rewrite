FROM node:12.13.0-alpine

# Setting working directory. All the path will be relative to WORKDIR
WORKDIR /usr/src/app

COPY package.json .
COPY yarn.lock .
RUN yarn

COPY next.config.js .
COPY tsconfig.json .

# Installing dependencies
COPY ./src ./src

ARG AZURE_SEARCH_API_VERSION
ARG AZURE_SEARCH_EXACTNESS_BOOST
ARG AZURE_SEARCH_INDEX
ARG AZURE_SEARCH_KEY
ARG AZURE_SEARCH_SCORING_PROFILE
ARG AZURE_SEARCH_SERVICE
ARG AZURE_SEARCH_WORD_FUZZINESS
ARG GOOGLE_GTM_CONTAINER_ID
ARG GOOGLE_TRACKING_ID
ARG GOOGLE_USE_DEBUG
ARG ROOT_URL_DOMAIN
ARG USE_GRAPHQL

ENV AZURE_SEARCH_API_VERSION=${AZURE_SEARCH_API_VERSION}
ENV AZURE_SEARCH_EXACTNESS_BOOST=${AZURE_SEARCH_EXACTNESS_BOOST}
ENV AZURE_SEARCH_INDEX=${AZURE_SEARCH_INDEX}
ENV AZURE_SEARCH_KEY=${AZURE_SEARCH_KEY}
ENV AZURE_SEARCH_SCORING_PROFILE=${AZURE_SEARCH_SCORING_PROFILE}
ENV AZURE_SEARCH_SERVICE=${AZURE_SEARCH_SERVICE}
ENV AZURE_SEARCH_WORD_FUZZINESS=${AZURE_SEARCH_WORD_FUZZINESS}
ENV GOOGLE_GTM_CONTAINER_ID=${GOOGLE_GTM_CONTAINER_ID}
ENV GOOGLE_TRACKING_ID=${GOOGLE_TRACKING_ID}
ENV GOOGLE_USE_DEBUG=${GOOGLE_USE_DEBUG}
ENV ROOT_URL_DOMAIN=${ROOT_URL_DOMAIN}
ENV USE_GRAPHQL=${USE_GRAPHQL}

RUN yarn build

# Running the app
CMD ["yarn", "start"]
